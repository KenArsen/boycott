{% extends 'layouts/base.html' %}

{% block title %}{{ product.name }} - Boycott Products Platform{% endblock %}

{% block content %}
    <section>
        <div class="container">
            <div class="product-detail">
                <div class="product-detail-header">
                    <div class="product-detail-image">
                        {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.name }}">
                        {% else %}
                            <img src="{% static 'images/placeholder.jpg' %}" alt="{{ product.name }}">
                        {% endif %}
                    </div>
                    <div class="product-detail-info">
                        <h1>{{ product.name }}</h1>
                        <p class="product-category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è: <a
                                href="{% url 'category_detail' product.category.slug %}">{{ product.category.name }}</a>
                        </p>

                        {% if product.is_boycotted %}
                            <div class="boycott-info">
                                <span class="product-boycott">–ë–æ–π–∫–æ—Ç–∏—Ä—É–µ—Ç—Å—è</span>
                                <h3>–ü—Ä–∏—á–∏–Ω–∞ –±–æ–π–∫–æ—Ç–∞:</h3>
                                <h4>{{ product.boycott_reason.title }}</h4>
                                <div class="boycott-description">
                                    {{ product.boycott_reason.description|linebreaks }}
                                </div>
                            </div>
                        {% else %}
                            <div class="rating-info">
                                <h3>–†–µ–π—Ç–∏–Ω–≥:</h3>
                                <p>{% include 'includes/star_rating.html' with rating=product.get_rating %}
                                    ({{ product.get_rating|floatformat:1 }}/5)</p>

                                {% if product.is_kyrgyz_product %}
                                    <div class="kyrgyz-product-badge">
                                        –ú–µ—Å—Ç–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç üá∞üá¨
                                    </div>
                                {% endif %}
                            </div>
                        {% endif %}

                        <div class="product-description">
                            <h3>–û–ø–∏—Å–∞–Ω–∏–µ:</h3>
                            <p>{{ product.description|linebreaks }}</p>
                        </div>
                    </div>
                </div>

                {% if product.is_boycotted and product.alternative_products.exists %}
                    <div class="alternatives-section" id="alternatives">
                        <h2>–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã</h2>
                        <div class="products-grid">
                            {% for alt_product in product.alternative_products.all %}
                                {% include 'includes/product_card.html' with product=alt_product %}
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}

                <div class="reviews-section">
                    <h2>–û—Ç–∑—ã–≤—ã ({{ product.reviews.count }})</h2>

                    {% if user.is_authenticated %}
                        <div class="review-form">
                            <h3>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h3>
                            <form method="post" action="{% url 'add_review' product.id %}">
                                {% csrf_token %}
                                <div class="form-group">
                                    <label for="rating">–†–µ–π—Ç–∏–Ω–≥:</label>
                                    <select name="rating" id="rating" required>
                                        <option value="5">5 - –û—Ç–ª–∏—á–Ω–æ</option>
                                        <option value="4">4 - –•–æ—Ä–æ—à–æ</option>
                                        <option value="3">3 - –ù–æ—Ä–º–∞–ª—å–Ω–æ</option>
                                        <option value="2">2 - –ü–ª–æ—Ö–æ</option>
                                        <option value="1">1 - –£–∂–∞—Å–Ω–æ</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
                                    <textarea name="comment" id="comment" rows="4"></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
                            </form>
                        </div>
                    {% else %}
                        <p><a href="{% url 'login' %}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤.</p>
                    {% endif %}

                    <div class="reviews-list">
                        {% for review in product.reviews.all %}
                            <div class="review-card">
                                <div class="review-header">
                                <span class="review-author">
                                    {% if review.user %}
                                        {{ review.user.username }}
                                    {% else %}
                                        –ê–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                                    {% endif %}
                                </span>
                                    <span class="review-date">{{ review.created_at|date:"d.m.Y" }}</span>
                                </div>
                                <div class="review-rating">
                                    {% include 'includes/star_rating.html' with rating=review.rating %}
                                </div>
                                <div class="review-comment">
                                    {{ review.comment|linebreaks }}
                                </div>
                            </div>
                        {% empty %}
                            <p>–û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}